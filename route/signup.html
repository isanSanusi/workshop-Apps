<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link
         rel="shortcut icon"
         href="../asset/img/LogiFlow.ico"
         type="image/x-icon"
      />
      <link
         rel="icon"
         type="image/png"
         sizes="16x10"
         href="../asset/img/LogiFlow-mini.png"
      />
      <link
         rel="apple-touch-icon"
         sizes="180x180"
         href="../asset/img/LogiFlow.png"
      />
      <link rel="manifest" href="/site.webmanifest" />
      <title>LogiFlow | Signup</title>
      <link rel="stylesheet" href="../asset/style/bootstrap-icons.css" />
      <link rel="stylesheet" href="../asset/style/flash.css" />
      <link rel="stylesheet" href="../asset/style/loginStyle.css" />
   </head>
   <body>
      <div class="login-container">
         <div class="login-card">
            <h2>Create New User</h2>
            <form id="signupForm">
               <div class="input-group">
                  <label for="username"
                     ><i class="bi bi-person-fill"></i
                  ></label>
                  <input
                     type="text"
                     id="username"
                     required
                     placeholder="Name new user"
                  />
               </div>
               <div class="input-group">
                  <label for="password"><i class="bi bi-lock-fill"></i></label>
                  <input
                     type="password"
                     id="password"
                     required
                     placeholder="Password new user"
                  />
               </div>
               <div class="roles">
                  <label for="role">Choose Role</label>
                  <select id="role" required>
                     <option value="admin">admin</option>
                     <option value="lapangan">lapangan</option>
                  </select>
               </div>
               <button type="submit" class="login-btn">Signup</button>
               <p class="back-link">
                  <a href="./admin.html">Back to Dashboard</a>
               </p>
            </form>
         </div>
      </div>

      <script src="../asset/js/bootstrap.bundle.js"></script>
      <script src="../asset/js/flash.js"></script>
      <script>
         document
            .getElementById("signupForm")
            .addEventListener("submit", function (e) {
               e.preventDefault();

               const username = document
                  .getElementById("username")
                  .value.trim();
               const password = document
                  .getElementById("password")
                  .value.trim();
               const role = document.getElementById("role").value;

               if (!username || !password) {
                  flashAlert("error", "Username and Password empty");
                  return;
               }

               // Ambil data user yang sudah ada
               let users = JSON.parse(localStorage.getItem("users")) || [];

               // Cek apakah username sudah dipakai
               if (users.some((u) => u.username === username)) {
                  flashAlert("error", "Username is exist");
                  return;
               }

               // Simpan user baru
               users.push({
                  username,
                  password,
                  role,
               });

               localStorage.setItem("users", JSON.stringify(users));
               flashAlert("success", "Horay..New user was added");
               setTimeout(() => {
                  window.location.href = "./admin.html";
               }, 2000);
            });
      </script>
   </body>
</html>
